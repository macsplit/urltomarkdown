<html>
    <head>
        <title>Convert URL to MarkDown</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
        <link href='https://fonts.googleapis.com/css?family=Lato:300,400,700' rel='stylesheet' type='text/css'>
	<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-md.png">
	<link rel="icon" type="image/png" href="apple-touch-icon-md.png" />
	<script   src="https://code.jquery.com/jquery-3.6.0.min.js"   integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="   crossorigin="anonymous"></script>
	<script>
		function blockedMessage(url) { return ([
			"Access to the content at " + url + " has been blocked by the source website's security policies, which actively prohibit automated access.",
			"To respect their server resources and our ethical policy of non-circumvention, we cannot fetch or reprocess this content for you.",
			"",
			"You can still use the open source ToMarkdown browser extensions, which run directly inside your browser and are not subject to the same restriction:",
			"",
			" - [For Firefox](https://addons.mozilla.org/en-GB/firefox/addon/tomarkdown/)",
			" - [For Safari (iOS/macOS)](https://apps.apple.com/us/app/tomarkdown/id1619533216)"
		].join("\n")) };

		function getmarkdown() {
			const url = $("#url").val();
			const title = $("#title").is(":checked");
			const links = !$("#links").is(":checked");
			const clean = $("#clean").is(":checked");

			$.ajax({
				url: "https://urltomarkdown.herokuapp.com",
				data: { url, title, links, clean },
				method: "GET",
				success: function (data) {
					$("#text").val(data);
				},
				error: function (jqXHR, textStatus, errorThrown) {
					const responseText = (jqXHR.responseText || "").trim();
					if (jqXHR.status === 502 && responseText.endsWith("403")) {
						$("#text").val(blockedMessage(url));
					} else {
						$("#text").val("Unable to fetch the requested page (" + jqXHR.status + " " + errorThrown + "). Please try again later.");
					}
				}
			});
		}
	</script>
	<style>
		.centered-label { margin-left: 2em;}
	</style>
    </head>
    <body>
        <div class="container">
            <div class="row">
				<div class="col-lg-12">
					<h1>Output Markdown</h1>
					<p class="lead">Please enter the URL of a web page</p>
					<div class="col-md-6">
						<div class="form-group">
							<label for="url">Source Web Page</label>
							<input id="url" type="url" name="url" class="form-control" placeholder="Please enter the URL" required="required" data-error="URL is required." />
					</div>
				</div>
				<div class="col-md-2">
					<div class="form-group">
						<label for="title" class="centered-label">Include Title</label>
						<input id="title" type="checkbox" name="title" class="form-control" checked />
					</div>
				</div>
				<div class="col-md-2">
					<div class="form-group">
						<label for="links" class="centered-label">Ignore Links</label>
						<input id="links" type="checkbox" name="links" class="form-control centered-checkbox" />
					</div>
				</div>
				<div class="col-md-2">
					<div class="form-group">
						<label for="clean" class="centered-label">Clean / Filter</label>
						<input id="clean" type="checkbox" name="clean" class="form-control centered-checkbox" checked />
					</div>
				</div>
				<div class="col-md-4">
					<input type="button" class="btn btn-success btn-send" value="Fetch and Convert" onclick="getmarkdown()">
				</div>
	</div>
	<div style="margin: 2em;">
		<textarea id="text" name="text" style="font-family: monospace, monospace; width: 100%; height: 100em;" onclick="this.select()">
		</textarea>
	</div>
	</form>
	<div>
		<small>Uses <a href="https://www.heroku.com/">heroku<a/>, <a href="https://www.npmjs.com/package/turndown">turndown</a>, <a href="https://www.npmjs.com/package/@mozilla/readability">Readability</a> and  <a href="https://www.npmjs.com/package/jsdom">jsdom</a>. Source on <a href="https://github.com/macsplit/urltomarkdown">github</a>.</small> 
	</div>
    </body>
</html>
